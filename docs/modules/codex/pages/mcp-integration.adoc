= MCP Integration

How MCP manifests become usable Codex config.

[mermaid]
....
sequenceDiagram
    participant Dev as Developer
    participant Manifest as MCP Manifests
    participant Script as merge-mcp-fragments.py
    participant Gen as codex-mcp.generated.toml
    participant Config as ~/.codex/config.toml
    participant Codex as Codex/IDE
    
    Dev->>Manifest: Edit servers.<slug>.json
    Manifest->>Script: Input: profile slugs
    Script->>Gen: Generate merged config
    Note over Gen: Local file, not committed
    Dev->>Gen: Review generated config
    Dev->>Config: Copy [mcp_servers.*] blocks
    Dev->>Config: Replace <TO_FILL> placeholders
    Dev->>Codex: Restart/Reload
    Codex->>Config: Load MCP servers
    Codex-->>Dev: MCP tools available
....

.MCP Integration Workflow
Sequence diagram showing how MCP manifests are merged and integrated into Codex configuration.

== Sources

- Manifests: `vscode/packs/*/mcp/servers.<slug>.json`
- Each server entry: `id`, `human_name`, `category`, `source`, `config_fragments`, flags (`optional`, `experimental`, `privacy_sensitive`, `recommended_read_only`).

== Merge workflow

[source,bash]
----
cd vscode
python scripts/merge-mcp-fragments.py core-base-dev fullstack-js-ts infra-devops docs-librarian
----

Result:

- `vscode/codex-mcp.generated.toml` (local, not committed)
- Commented metadata showing which profiles contributed each server
- `<TO_FILL>` placeholders for commands/args/env to be filled from official server docs

== Applying to Codex

1. Open your `~/.codex/config.toml` (or `%USERPROFILE%/.codex/config.toml`).
2. Copy only the `[mcp_servers.*]` blocks you want from `codex-mcp.generated.toml`.
3. Replace `<TO_FILL>` with real commands/args/env.
4. Save and restart Codex/IDE if needed.

== Safety and flags

Use manifest flags to decide what to enable:

- `optional`: leave out unless needed.
- `experimental`: keep to experimental-preview contexts.
- `privacy_sensitive`: enable only where external logging is acceptable.
- `recommended_read_only`: prefer read-only operations (e.g. get/list/watch).

== Bundles

Bundles may include a slug-scoped generated MCP TOML for convenience, but it is still treated as a generated artefact. Do not commit `codex-mcp.generated.toml`; regenerate when manifests change.

Related pages: xref:config-guides.adoc[] and xref:safe-vs-danger-modes.adoc[].
